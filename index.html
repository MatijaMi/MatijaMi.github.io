<!DOCTYPE html>

<html lang="en" style="height: 100%">
    
    <head>
    	<link rel="icon" href="icon.svg">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CR2 Decoder</title>
        <link rel="stylesheet" href="style.css">
        <script src="Scripts/metaData.js"></script>
		<script src="Scripts/ByteTransformations.js"></script>
    	<script src="Scripts/IFDFunctions.js"></script>
		<script src="Scripts/debug.js"></script>
		<script src="Scripts/MakerNoteFunctions.js"></script>
		<script src="Scripts/DHTFunctions.js"></script>
		<script src="Scripts/SOF3.js"> </script>
		<script src="Scripts/SOS.js"></script>
		<script src="Scripts/RGGB.js"></script>
		<script src="Scripts/YYYYCbCr.js"></script>
		<script src="Scripts/YYCbCr.js"></script>
		<script src="Scripts/BayerInterpolation.js"></script>
		<script src="Scripts/DownloadFunctions.js"></script>
		<script src="Scripts/decodeHandler.js"></script>
    </head>
    
    <body>
		
		<div class="header"> 
			<a href="index.html">Home</a>
			<a>CR2</a>
			<a>FAQ</a>
			<a>About</a>
		</div>
		
		<div class="content"> 
			
			<h1> CR2 Decoder</h1>
			<div  id="inputBox" class="inputBox">
				<input type="file" id="fileInput" name="files">
				<div class="dropzone" id="dropzone" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);">
					<label id="label" for="fileInput">Upload a .CR2 file</label>
				</div>
				<button class="submit" onclick="startScan()"> Submit</button>
				
				
				<div class="left" id="left">
				<div id="info"></div>
					</div>
				
				
				<div class="right" id="right">
					
					<div class="image" id="image"></div>
					
					<button class="download" onclick="downloadJpeg()"> Download as Jpeg</button>
					<button class="download" onclick="downloadRaw()"> Download Raw Bytes</button>
					
					<div class="decodeY" id="decodeY">
						<button onclick="decodeYCC(false)"> Decode as YYCbCr</button>
						<button onclick="decodeYCC(true)"> Decode as RGB</button>
					</div>
					<div  class="decodeR" id="decodeR">
						<button onclick="downloadJpeg()"> Decode as RGGB</button>
						<button onclick="downloadJpeg()"> Decode as RGB</button>
					</div>
					<div  class="decodeYY" id="decodeYY">
						<button onclick="downloadJpeg()"> Decode as YYYYCbCr</button>
						<button onclick="downloadJpeg()"> Decode as RGB</button>
					</div>
					
					<div class="progressBar" id="progressBar">
						<div class="bar" id="bar">0%</div>
					</div>
					
					<button class="download2" id="dycc" onclick="downloadYCC()"> Download YCbCr</button>
					<button class="download2" id="dyycc" onclick="downloadYYCC()"> Download YYYYCbCr</button>
					<button class="download2" id="drggb" onclick="downloadRGGB()"> Download RGGB</button>
					<button class="download2" id="drgb" onclick="downloadRGB()"> Download RGB</button>
				</div>
		</div>
		<div class="intro">
			<h3>What is CR2 Decoder?</h3>
			<p>CR2 Decoder is a project aimed at making working with Canon Raw 2 files easier by making the raw data that the camera collects, as well as the meta data used by the camera more accesible and easier to extract from the  .CR2 file. It also functions as a simple .CR2 to .JPEG converter for those who only need that function. Seeing as there is only so much knowledege about the .CR format that has been found out there are certain limitations as to what this tool can do and we cannot promise that it will work with every camera and every file that you choose. It is also still a work in progress so a lot of improvements are always on the way and in case you encounter any bugs or problems please do report them to our team so we can deal with them switfly and on time.
			</p>
			
			</div>
		
		
		</div>

		
		
		<script  type="text/javascript">
			
			const inputElement = document.getElementById("fileInput");
			inputElement.addEventListener("change", handleFiles, false);
			window.imageCount=0;
			
			function handleFiles() {
					window.fileList = this.files; /* now you can work with the file list */
				readFile(fileList[0]);
				
			}
			
			function download(){
				saveByteArray([bytes], "example.jpg");
			}
			function downloadJpeg(){
				var image0Offset = findIFDTagValue(16,17,1,false,false);
				var image0Length = findIFDTagValue(16,23,1,false,false);
				var data=bytes.slice(image0Offset,image0Offset+image0Length);
				saveByteArray([data], "example.jpg");
			}
			
			function dragOverHandler(ev) {
  				ev.preventDefault();
			}
			
			function dropHandler(ev) {
  				ev.preventDefault();

  				if (ev.dataTransfer.items) {
					readFile(ev.dataTransfer.items[0].getAsFile());
					

  				}
			}
		
		</script>
    </body>
</html>